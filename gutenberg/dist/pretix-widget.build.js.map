{"version":3,"file":"pretix-widget.build.js","mappings":"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","sources":["webpack://pretix-widget/./src/blocks/pretix-widget/components/server_side_renderer/index.js","webpack://pretix-widget/./src/blocks/pretix-widget/edit.js","webpack://pretix-widget/./src/blocks/pretix-widget/index.js","webpack://pretix-widget/./src/blocks/pretix-widget/save.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nconst { useDebounce, usePrevious } = wp.compose;\r\nconst { RawHTML, useEffect, useRef, useState } = wp.element;\r\nconst { __, sprintf } = wp.i18n;\r\nconst apiFetch = wp.apiFetch;\r\nconst { addQueryArgs } = wp.url;\r\nconst { Placeholder, Spinner } = wp.components;\r\nconst { __experimentalSanitizeBlockAttributes } = wp.blocks;\r\n\r\nexport function rendererPath( block, attributes = null, urlQueryArgs = {} ) {\r\n\treturn addQueryArgs( `/wp/v2/block-renderer/${ block }`, {\r\n\t\tcontext: 'edit',\r\n\t\t...( null !== attributes ? { attributes } : {} ),\r\n\t\t...urlQueryArgs,\r\n\t} );\r\n}\r\n\r\nfunction DefaultEmptyResponsePlaceholder( { className } ) {\r\n\treturn (\r\n\t\t<Placeholder className={ className }>\r\n\t\t\t{ __( 'Block rendered as empty.' ) }\r\n\t\t</Placeholder>\r\n\t);\r\n}\r\n\r\nfunction DefaultErrorResponsePlaceholder( { response, className } ) {\r\n\tconst errorMessage = sprintf(\r\n\t\t// translators: %s: error message describing the problem\r\n\t\t__( 'Error loading block: %s' ),\r\n\t\tresponse.errorMsg\r\n\t);\r\n\treturn <Placeholder className={ className }>{ errorMessage }</Placeholder>;\r\n}\r\n\r\nfunction DefaultLoadingResponsePlaceholder( { children, showLoader } ) {\r\n\treturn (\r\n\t\t<div style={ { position: 'relative' } }>\r\n\t\t\t{ showLoader && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\t\ttop: '50%',\r\n\t\t\t\t\t\tleft: '50%',\r\n\t\t\t\t\t\tmarginTop: '-9px',\r\n\t\t\t\t\t\tmarginLeft: '-9px',\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t<Spinner />\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t\t<div style={ { opacity: showLoader ? '0.3' : 1 } }>\r\n\t\t\t\t{ children }\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default function ServerSideRender( props ) {\r\n\tconst {\r\n\t\tattributes,\r\n\t\tblock,\r\n\t\tclassName,\r\n\t\thttpMethod = 'GET',\r\n\t\turlQueryArgs,\r\n\t\tEmptyResponsePlaceholder = DefaultEmptyResponsePlaceholder,\r\n\t\tErrorResponsePlaceholder = DefaultErrorResponsePlaceholder,\r\n\t\tLoadingResponsePlaceholder = DefaultLoadingResponsePlaceholder,\r\n\t} = props;\r\n\t\r\n\tconst isMountedRef = useRef( true );\r\n\tconst [ showLoader, setShowLoader ] = useState( false );\r\n\tconst fetchRequestRef = useRef();\r\n\tconst [ response, setResponse ] = useState( null );\r\n\tconst prevProps = usePrevious( props );\r\n\tconst [ isLoading, setIsLoading ] = useState( false );\r\n\t\r\n\tfunction fetchData() {\r\n\t\tif ( ! isMountedRef.current ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tsetIsLoading( true );\r\n\t\t\r\n\t\tconst sanitizedAttributes =\r\n\t\t\tattributes &&\r\n\t\t\t__experimentalSanitizeBlockAttributes( block, attributes );\r\n\t\t\r\n\t\t// If httpMethod is 'POST', send the attributes in the request body instead of the URL.\r\n\t\t// This allows sending a larger attributes object than in a GET request, where the attributes are in the URL.\r\n\t\tconst isPostRequest = 'POST' === httpMethod;\r\n\t\tconst urlAttributes = isPostRequest\r\n\t\t\t? null\r\n\t\t\t: sanitizedAttributes ?? null;\r\n\t\tconst path = rendererPath( block, urlAttributes, urlQueryArgs );\r\n\t\tconst data = isPostRequest\r\n\t\t\t? { attributes: sanitizedAttributes ?? null }\r\n\t\t\t: null;\r\n\t\t\r\n\t\t// Store the latest fetch request so that when we process it, we can\r\n\t\t// check if it is the current request, to avoid race conditions on slow networks.\r\n\t\tconst fetchRequest = ( fetchRequestRef.current = apiFetch( {\r\n\t\t\tpath,\r\n\t\t\tdata,\r\n\t\t\tmethod: isPostRequest ? 'POST' : 'GET',\r\n\t\t} )\r\n\t\t\t.then( ( fetchResponse ) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tisMountedRef.current &&\r\n\t\t\t\t\tfetchRequest === fetchRequestRef.current &&\r\n\t\t\t\t\tfetchResponse\r\n\t\t\t\t) {\r\n\t\t\t\t\tsetResponse( fetchResponse.rendered );\r\n\t\t\t\t}\r\n\t\t\t} )\r\n\t\t\t.catch( ( error ) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tisMountedRef.current &&\r\n\t\t\t\t\tfetchRequest === fetchRequestRef.current\r\n\t\t\t\t) {\r\n\t\t\t\t\tsetResponse( {\r\n\t\t\t\t\t\terror: true,\r\n\t\t\t\t\t\terrorMsg: error.message,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} )\r\n\t\t\t.finally( () => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tisMountedRef.current &&\r\n\t\t\t\t\tfetchRequest === fetchRequestRef.current\r\n\t\t\t\t) {\r\n\t\t\t\t\tsetIsLoading( false );\r\n\t\t\t\t}\r\n\t\t\t} ) );\r\n\t\t\r\n\t\treturn fetchRequest;\r\n\t}\r\n\t\r\n\tconst debouncedFetchData = useDebounce( fetchData, 500 );\r\n\t\r\n\t// When the component unmounts, set isMountedRef to false. This will\r\n\t// let the async fetch callbacks know when to stop.\r\n\tuseEffect(\r\n\t\t() => () => {\r\n\t\t\tisMountedRef.current = false;\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\t\r\n\tuseEffect( () => {\r\n\t\t// Don't debounce the first fetch. This ensures that the first render\r\n\t\t// shows data as soon as possible.\r\n\t\tif ( prevProps === undefined ) {\r\n\t\t\tfetchData();\r\n\t\t} else if ( JSON.stringify(prevProps) !== JSON.stringify(props) ) {\r\n\t\t\tdebouncedFetchData();\r\n\t\t}\r\n\t} );\r\n\t\r\n\t/**\r\n\t * Effect to handle showing the loading placeholder.\r\n\t * Show it only if there is no previous response or\r\n\t * the request takes more than one second.\r\n\t */\r\n\tuseEffect( () => {\r\n\t\tif ( ! isLoading ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst timeout = setTimeout( () => {\r\n\t\t\tsetShowLoader( true );\r\n\t\t}, 2000 );\r\n\t\treturn () => clearTimeout( timeout );\r\n\t}, [ isLoading ] );\r\n\t\r\n\tconst hasResponse = !! response;\r\n\tconst hasEmptyResponse = response === '';\r\n\tconst hasError = response?.error;\r\n\t\r\n\tif ( isLoading ) {\r\n\t\treturn (\r\n\t\t\t<LoadingResponsePlaceholder { ...props } showLoader={ showLoader }>\r\n\t\t\t\t{ hasResponse && (\r\n\t\t\t\t\t<RawHTML className={ className }>{ response }</RawHTML>\r\n\t\t\t\t) }\r\n\t\t\t</LoadingResponsePlaceholder>\r\n\t\t);\r\n\t}\r\n\t\r\n\tif ( hasEmptyResponse || ! hasResponse ) {\r\n\t\treturn <EmptyResponsePlaceholder { ...props } />;\r\n\t}\r\n\t\r\n\tif ( hasError ) {\r\n\t\treturn <ErrorResponsePlaceholder response={ response } { ...props } />;\r\n\t}\r\n\t\r\n\treturn <RawHTML className={ className }>{ response }</RawHTML>;\r\n}","const {useEffect, useState} = wp.element;\r\nconst { __ } = wp.i18n;\r\nconst { TextControl, ToggleControl, SelectControl, PanelBody, Placeholder, Spinner } = wp.components;\r\nimport ServerSideRender from './components/server_side_renderer';\r\n\r\nconst {\r\n\tInnerBlocks,\r\n\tuseBlockProps,\r\n\tInspectorControls,\r\n\tBlockControls,\r\n\tstore\r\n} = wp.blockEditor;\r\n\r\nconst defaults = pretixWidgetDefaults ?? [];\r\nconst languages = pretixWidgetLanguages ? Object.values(pretixWidgetLanguages) : [\r\n\t{\r\n\t\t\"code\": \"en\",\r\n\t\t\"locale\": \"en_GB\",\r\n\t\t\"name\": \"English\",\r\n\t\t\"supported\": true\r\n\t},\r\n\t{\r\n\t\t\"code\": \"de\",\r\n\t\t\"locale\": \"de_DE\",\r\n\t\t\"name\": \"German\",\r\n\t\t\"supported\": true\r\n\t},\r\n];\r\n\r\nexport default function Edit(props) {\r\n\tconst {\r\n\t\tclientId,\r\n\t\tattributes,\r\n\t\tsetAttributes,\r\n\t} = props;\r\n\r\n\t// add defaults to attributes\r\n\tconst {\r\n\t\talign,\r\n\t\tmode = 'widget',\r\n\t\tdisplay = 'list',\r\n\t\tshop_url,\r\n\t\titems = '',\r\n\t\tcategories = '',\r\n\t\tvariations = '',\r\n\t\tdisable_voucher = false,\r\n\t\tallocated_voucher = '',\r\n\t\tlanguage = 'en',\r\n\t\tbutton_text = 'Buy Ticket!',\r\n\t} = attributes;\r\n\t\r\n\tconst blockProps = useBlockProps();\r\n\t\r\n\tconst [loading, setLoading] = useState(false);\r\n\t\r\n\tconst handleChange = (key, value) => {\r\n\t\tsetAttributes({ [key]: value });\r\n\t}\r\n\t\r\n\tfunction isValidUrl(url) {\r\n\t\t// Regular expression for URL validation\r\n\t\tvar urlPattern = /^(https?:\\/\\/)?[\\w.-]+\\.[a-zA-Z]{2,}(\\/\\S*)?$/;\r\n\t\treturn urlPattern.test(url);\r\n\t}\r\n\t\r\n\tconst insertScriptAssets = () =>{\r\n\t\tif(isValidUrl(shop_url)){\r\n\t\t\tconst scriptId = 'pretix-widget-script-' + clientId;\r\n\t\t\tlet script = document.getElementById(scriptId);\r\n\t\t\tif(script){\r\n\t\t\t\tdocument.body.removeChild(script);\r\n\t\t\t}\r\n\t\t\tscript = document.createElement(\"script\");\r\n\t\t\tscript.id = scriptId;\r\n\t\t\twindow.PretixWidget = null;\r\n\t\t\t\r\n\t\t\tconst url = new URL(shop_url);\r\n\t\t\tconst _url = url.hostname;\r\n\t\t\tconst filename = language.replace('_', '-');\r\n\t\t\tscript.src = `https://${_url}/widget/v1.${filename}.js?timestamp=${Date.now()}`;\r\n\t\t\tscript.async = true;\r\n\t\t\tscript.onload = () => {\r\n\t\t\t\twindow.PretixWidget.buildWidgets();\r\n\t\t\t};\r\n\t\t\tdocument.body.appendChild(script);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tconst insertCSSAssets = () =>{\r\n\t\tif(isValidUrl(shop_url)) {\r\n\t\t\tconst linkId = 'pretix-widget-style-' + clientId;\r\n\t\t\tlet link = document.getElementById(linkId);\r\n\t\t\tif (link) {\r\n\t\t\t\tdocument.body.removeChild(link);\r\n\t\t\t}\r\n\t\t\tlink = document.createElement(\"link\");\r\n\t\t\tlink.rel = \"stylesheet\";\r\n\t\t\tconst url = new URL(shop_url);\r\n\t\t\tconst _url = url.hostname + url.pathname.replace(/\\/$/, '')\r\n\t\t\tlink.href = `https://${_url}/widget/v1.css?timestamp=${Date.now()}`;\r\n\t\t\tdocument.head.appendChild(link);\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst EmptyResponsePlaceholder = () => <Placeholder label={'Empty'}/>;\r\n\tconst ErrorResponsePlaceholder = () => <Placeholder label={'Error'}/>;\r\n\t\r\n\t// server side render trigger\r\n\tconst TriggerWhenLoadingFinished = countChildren => {\r\n\t\treturn () => {\r\n\t\t\tuseEffect( () => {\r\n\t\t\t\t// Call action when the loading component unmounts because loading is finished.\r\n\t\t\t\treturn () => {\r\n\t\t\t\t\tinsertScriptAssets();\r\n\t\t\t\t\tinsertCSSAssets();\r\n\t\t\t\t};\r\n\t\t\t} );\r\n\t\t\t\r\n\t\t\treturn (<Placeholder label={'Loading...'}/>);\r\n\t\t};\r\n\t};\r\n\t\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<InspectorControls>\r\n\t\t\t\t<PanelBody title={__('Settings', 'pretix-widget')} initialOpen={true}>\r\n\t\t\t\t\t<SelectControl\r\n\t\t\t\t\t\tlabel={__('Mode', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={mode}\r\n\t\t\t\t\t\toptions={[\r\n\t\t\t\t\t\t\t{ value: 'widget', label: __('Widget', 'pretix-widget') },\r\n\t\t\t\t\t\t\t{ value: 'button', label: __('Button', 'pretix-widget') },\r\n\t\t\t\t\t\t]}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('mode', value)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{mode === 'button' && (\r\n\t\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\t\tlabel={__('Button Text', 'pretix-widget')}\r\n\t\t\t\t\t\t\tvalue={button_text}\r\n\t\t\t\t\t\t\tonChange={(value) => handleChange('button_text', value)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\tlabel={__('Shop URL', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={shop_url}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('shop_url', value)}\r\n\t\t\t\t\t\ttype=\"url\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{/*\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\tlabel={__('Event', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={event}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('event', value)}\r\n\t\t\t\t\t/>*/}\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\tlabel={__('Items', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={items}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('items', value)}\r\n\t\t\t\t\t\thelp={__('Enter a comma-separated list of ID numbers.', 'pretix-widget')}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\tlabel={__('Categories', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={categories}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('categories', value)}\r\n\t\t\t\t\t\thelp={__('Enter a comma-separated list of ID numbers.', 'pretix-widget')}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\tlabel={__('Variations', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={variations}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('variations', value)}\r\n\t\t\t\t\t\thelp={__('Enter a comma-separated list of ID numbers.', 'pretix-widget')}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\tlabel={__('Pre-selected voucher', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={allocated_voucher}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('allocated_voucher', value)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<SelectControl\r\n\t\t\t\t\t\tlabel={__('Event selection mode', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={display}\r\n\t\t\t\t\t\toptions={[\r\n\t\t\t\t\t\t\t{ value: 'auto', label: __('Auto', 'pretix-widget') },\r\n\t\t\t\t\t\t\t{ value: 'list', label: __('List', 'pretix-widget') },\r\n\t\t\t\t\t\t\t{ value: 'calendar', label: __('Calendar', 'pretix-widget') },\r\n\t\t\t\t\t\t\t{ value: 'week', label: __('Week', 'pretix-widget') },\r\n\t\t\t\t\t\t]}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('display', value)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<ToggleControl\r\n\t\t\t\t\t\tlabel={__('Disable voucher input', 'pretix-widget')}\r\n\t\t\t\t\t\tchecked={disable_voucher}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('disable_voucher', value)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<SelectControl\r\n\t\t\t\t\t\tlabel={__('Default Language', 'pretix-widget')}\r\n\t\t\t\t\t\tvalue={language}\r\n\t\t\t\t\t\toptions={languages.map(({ code, name }) => ({\r\n\t\t\t\t\t\t\tvalue: code,\r\n\t\t\t\t\t\t\tlabel: name\r\n\t\t\t\t\t\t}))}\r\n\t\t\t\t\t\tonChange={(value) => handleChange('language', value)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</PanelBody>\r\n\t\t\t</InspectorControls>\r\n\t\t\t\r\n\t\t\t<div {...blockProps}>\r\n\t\t\t\t<ServerSideRender\r\n\t\t\t\t\tblock=\"pretix/widget\"\r\n\t\t\t\t\tattributes={attributes}\r\n\t\t\t\t\tLoadingResponsePlaceholder={TriggerWhenLoadingFinished(attributes)}\r\n\t\t\t\t\tEmptyResponsePlaceholder={EmptyResponsePlaceholder}\r\n\t\t\t\t\tErrorResponsePlaceholder={ErrorResponsePlaceholder}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","const { registerBlockType } = wp.blocks;\r\n\r\nimport metadata from './block.json';\r\nimport edit from './edit.js';\r\nimport save from './save.js';\r\n\r\nregisterBlockType('pretix/widget', {\r\n\t...metadata,\r\n\tedit,\r\n\tsave,\r\n});\r\n","export default function save(props) {\r\n\treturn null;\r\n}"],"names":["_wp$compose","wp","compose","useDebounce","usePrevious","_wp$element","element","RawHTML","useEffect","useRef","useState","_wp$i18n","i18n","__","sprintf","apiFetch","addQueryArgs","url","_wp$components","components","Placeholder","Spinner","__experimentalSanitizeBlockAttributes","blocks","DefaultEmptyResponsePlaceholder","_ref","className","React","createElement","DefaultErrorResponsePlaceholder","_ref2","response","errorMessage","errorMsg","DefaultLoadingResponsePlaceholder","_ref3","children","showLoader","style","position","top","left","marginTop","marginLeft","opacity","ServerSideRender","props","attributes","block","_props$httpMethod","httpMethod","urlQueryArgs","_props$EmptyResponseP","EmptyResponsePlaceholder","_props$ErrorResponseP","ErrorResponsePlaceholder","_props$LoadingRespons","LoadingResponsePlaceholder","isMountedRef","_useState2","_slicedToArray","setShowLoader","fetchRequestRef","_useState4","setResponse","prevProps","_useState6","isLoading","setIsLoading","fetchData","current","sanitizedAttributes","isPostRequest","path","arguments","length","undefined","concat","_objectSpread","context","rendererPath","data","fetchRequest","method","then","fetchResponse","rendered","error","message","debouncedFetchData","JSON","stringify","timeout","setTimeout","clearTimeout","hasResponse","hasEmptyResponse","hasError","_extends","TextControl","ToggleControl","SelectControl","PanelBody","_wp$blockEditor","blockEditor","useBlockProps","InnerBlocks","InspectorControls","languages","BlockControls","store","pretixWidgetDefaults","pretixWidgetLanguages","Object","values","registerBlockType","metadata","edit","clientId","setAttributes","_attributes$mode","align","mode","_attributes$display","display","shop_url","_attributes$items","items","_attributes$categorie","categories","_attributes$variation","variations","_attributes$disable_v","disable_voucher","_attributes$allocated","allocated_voucher","_attributes$language","language","_attributes$button_te","button_text","blockProps","handleChange","key","value","_defineProperty","isValidUrl","test","Fragment","title","initialOpen","label","options","onChange","type","help","checked","map","code","name","scriptId","script","document","getElementById","body","removeChild","id","window","PretixWidget","_url","URL","hostname","filename","replace","src","Date","now","async","onload","buildWidgets","appendChild","insertScriptAssets","linkId","link","rel","pathname","href","head","insertCSSAssets","save"],"sourceRoot":""}